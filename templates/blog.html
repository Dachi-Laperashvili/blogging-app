{% extends 'base.html' %}
{% block style %}
    a{
        text-decoration: none;
    }
    .delete_cont {
        display: none;
        justify-content: center;
        align-items: center;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }
    .modal-content{
        background-color:#fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 30%;
    }
    .cancel, .delete{
        float: left;
        width: 40%;
    }
{% endblock %}
{% block content %}
<div class="container border mb-5 rounded shadow-lg w-50" style="margin-top:90px">
    <div>
        <img class="img-fluid mt-2" alt="{{ post.image }}" src="/static/images/{{ post.image }}">
    </div>
    <div class="mt-3 text-center">
        <div class="row">
            <h1>{{ post.title }}</h1>
        </div>
    </div>
    <div class="container mb-4">
        <div class="row">
            {{ post.content }}
        </div>
        <div class="my-3">
            <button class="like-btn btn border" data-blog-slug="{{ post.slug }}">
                <i class="fa-regular fa-thumbs-up likeIcon"></i>
                <span class="like-count">{{ post.likes }}</span>
            </button>
        </div>
    </div>
</div>
    <div class="container border mb-5 rounded shadow-lg w-50">
        {% if current_user.is_authenticated %}
            <form class="mb-3" method="post" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                <div class="d-flex align-items-center mt-3 ">
                    <img class="rounded-circle mx-2" style="height: 50px; width: 50px;" src="/static/pfp/{{ current_user.picture }}" alt="{{ current_user.picture }}" title="{{ current_user.username }}">
                    {{ form.message(class="form-control", placeholder=form.message.label.text) }}
                    {{ form.comment(class="btn bg-primary mt-2 text-white m-2")}}
                </div>
            </form>
            {% elif post.comments %}
            <h1 class="text-center">Comments:</h1>
        {% endif %}

        <div class="row">
            {% for comment in post.comments  %}
                <div class="d-flex p-3 bg-body">
                <img class="rounded-circle mx-2" style="height: 50px; width: 50px;" alt="{{ comment.user.picture }}" src="/static/pfp/{{ comment.user.picture }}">
                    <div class="d-flex align-items-center justify-content-between border rounded bg-light d-block p-2 align-items-center">
                        <div class="flex-column">
                            <h6>{{ comment.user.username }}</h6>
                            <p class="mb-0" title="{{ comment.date.strftime('%B %d, %Y %H:%M ') }}">{{ comment.comment }}</p>
                        </div>
                        {% if current_user.id == comment.user_id %}
                        <div class="dropdown mb-5">
                            <i class="fa-solid fa-ellipsis"  data-bs-toggle="dropdown" aria-expanded="false" style="cursor:pointer"></i>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" onclick="document.querySelector('.delete_cont').style.display= 'flex'" style="cursor:pointer">
                                    <i class="bi bi-trash3-fill"></i> Delete
                                </a></li>
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="delete_cont">
                <div class="modal-content border rounded">
                    <div class="delete_txt px-2 pb-4 pt-3">
                        <h3>Delete Comment?</h3>
                    </div>
                    <div class="px-2">
                        <p>This will delete comment</p>
                    </div>
                    <div>
                        <form id="deleteForm" action="/home/{{ post.slug }}/delete/{{ comment.id }}" method="POST">
                            <button type="button" class="cancel btn btn-light border m-2" onclick="document.querySelector('.delete_cont').style.display = 'none'">
                                Cancel
                            </button>
                            <button class="delete btn btn-danger border m-2" type="submit">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}